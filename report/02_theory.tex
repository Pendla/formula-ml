\chapter{Theoretical Framework}
% Explain concepts that we rely upon throughout the report. 
This chapter will introduce the theoretical framework of the project. The following sections will include an explanation of the underlying theory and physics of racing, an introduction to the challenges of digital simulation and an overview of machine learning concepts used in the project. 

\section{Racing theory}
This section will describe some fundamental aspects of racing theory. As mentioned previously, the scope is limited to racing with a single car that drive around a track with as little time possible.

Racing tracks are normally broad enough to allow slightly different paths for the driver. The path a driver take also affect the possible speed, and the speed affect how quickly the car can turn. Time is the result from both distance and speed according to the following formula:
\begin{equation}
t = \frac{d}{v}
\end{equation}
Where $d$ is the distance driven and $v$ is the average speed. The process of minimising the time is a process of both minimising the distance driven and maximising the speed. It takes skill as the two need to be balanced properly.

The next subsection will briefly describe the physics of racing. It is a core part of understanding how professional drivers drive, as will be described in the second next subsection.

\subsection{Underlying aspects of physics}
A moving car has momentum. In order to to change the momentum, to accelerate, brake or change direction of movement, a force need to be applied. These forces are applied through the tyres. 

The abilities of the car is limited to how great force it can apply through the tyres. If the car exceed the available traction, the tyres slide or spin. 

The brakes are generally very efficient and are mostly limited by the traction of the tyres, whereas accelerating is limited by the torque of the engine. In addition to this, drag pull to slow the down. When the car brakes, the tyres and the drag will work together, but an accelerating car has to work against the drag. These aspects make cars accelerate slower than they can brake.

As the speed increases, the kinetic energy increases quadratically. A consequence is that a greater force is required to change the momentum. Accelerating and braking takes longer time and the turning radius is larger. The turning radius for a circular motion is:
\begin{equation}
a_c = \frac{v^2}{r} \cite{beckman:circular_motion} 
\rightarrow
\frac{F_c}{m} = \frac{v^2}{r} 
\rightarrow
r = \frac{mv^2}{F_c}
\end{equation}
Where $a_c$ is the central acceleration, $v$ is the speed, $r$ is the radius of the curcular motion, $F_c$ is the central force and $m$ is the mass of the car.

The car can not turn as much when it accelerates or brakes. When a car accelerates or brake, the amount of pressure on the tyres will change, changing the traction capabilities. This make limit the amount a car car accelerate or brake and turn at the same time \cite{beckman:weight_transfer}. The effect is further increased as the tyres can not produce traction for multiple directions as well as for a single direction\cite{beckman:traction_budget}. 

Due to the shape of a racing car, drag contribute to the traction as the car is pushed down, a so called down force. As the speed get larger, this effect is also increased.


\subsection{Introduction to racing lines}
A racing line denotes the path a car drive around the track.

As previously mentioned, driving fast and driving short are the key aspects to optimise, but they sometimes opposite each other. If the car drives fast, the turning radius is increased and the car might need to drive a longer path, which may take longer time in total. 

However, if the car exit a curve with a higher speed, it can benefit from a reduced time spent in the next section. It is therefore generally beneficial to prioritise higher speed on longer sections\cite{beckman:racing_line_intro}, as the difference in speed will accumulate more time.

A typical behaviour is therefore to position the car on the opposite side of where a curve is turning [insert illustration]. This enables a larger turning radius. The car brakes as late as possible to not loose time on the previous section, but turns most intensively rather early in the curve, so that it can start accelerating for the next section as early as possible. This curve will result in a late apex.

But, if another corner come close after, it might be more beneficial to exit the first curve in the way that makes the second curve most efficient. Not as much saved time can be accumulated by an increase of speed, so, the focus also shifts slightly to drive short. [insert illustration]

\section{Digital Simulation}
% - Discrete steps
% - Numerical errors

This section will present some key aspects of digital simulation. 

A computer cannot handle continues calculations and must rely on models of reality. This will introduce numerical errors in the calculations. It is therefore important to motivate that the errors introduced are small enough for it to not decrease the quality of the simulation.

The simulator holds a state of what it simulates. As the simulation progress by calculating what the new state should be after an amount of time. 

One of the limitations of this way of simulating is that it difficult to take in to account events that should have occurred during the time slice, or multiple degrees of derivatives. 

The mentioned limitations may lead to problems, typically for closed systems that should stay stable over time, for example planets in orbit. 

\section{Machine Learning}
Machine learning is the field of study that concentrates on algorithms that can be said to learn \cite{glossary}. This section will cover the machine learning theory and concepts that were considered and used within the project. Furthermore the suitability of the different algorithms within the problem domain will be discussed.  

\subsection{Neural networks as knowledge model}
Machine learning algorithms require some representation of knowledge. One such knowledge model that is in wide use is the Artificial neural network. A neural network is a mathematical model that mimic the structure of the human brain. 

A neural network can represent a mathematical function since it connects a set of input values with a set of output values, thus representing a mapping from the input space to the output space. Changes to the structure of the network changes the nature of the represented functions. 

A neural network with at least two hidden layers with sigmoid functions as its activation function can be used to approximate any real function and the possible accuracy increases with the number of nodes \cite{mitchel:approximation}.

\subsection{Supervised Learning}
Supervised learning is the process of learning with a teacher or learning from examples \cite{haykin:supervised}. A large set of example data consisting of pairs of input configurations and the corresponding correct output is used. The learning process works by letting the knowledge model, for example a neural network, predict the correct output for given inputs in the data set. The knowledge model is then corrected in order to better predict the correct output. Algorithms that learn by induction often fall into the supervised learning category \cite{glossary}.  

\subsection{Unsupervised Learning}
Unsupervised learning is a type of machine learning that in contrast to supervised learning does not learn to predict or approximate a correct output given an input, but rather learn to group sets of inputs into categories based on the input values. These algorithms are prevalent in data mining and other areas where clustering is useful. 

\subsection{Reinforcement Learning}
A central aspect of the learning process is evaluating the performance of the actor. Supervised learning algorithms compare the actors output with a set of correct values. However if there is no data set available to train on the feedback must be acquired in some other way. Reinforcement learning algorithms solve this by scoring actors on how well they perform. The set of example data used in supervised learning is replaced by some quantifiable measurement of performance, often calculated from a heuristic. 

The performance is used as the basis of some transforming process that improves the actor itself or the whole population. The modification process differs between knowledge models and learning algorithms. In a neural network the process would change the weights or topology of the network in order to improve its performance.

\subsection{Neuroevolution}
Neuroevolution is a type of machine learning that learns by emulating natural selection. In neuroevolution, the algorithm learns by evolving neural networks to solve a specific task. 
The evolution process works by allowing advantageous traits to remain while disadvantageous traits are removed.  

This can be done on different levels of abstraction. For example on the individual level, where well-adapted individuals are allowed to carry on their traits. It can also be done on the level of singular traits, for example connections in a neural network.

This type of machine learning has been shown to be effective in comparison to other machine learning algorithms at solving non-linear control tasks such as the pole balancing problem \cite{gomez:efficient_nonlinear_control}.

\subsection{Neuroevolution through Augmenting Topologies}
One neuroevolution algorithm is Neuroevolution through Augmenting Topologies, henceforth referred to as NEAT. In NEAT the evolution process is simulated on a pool of actors that are divided into groups called species. Actors are only compared within their species in order to allow for greater diversity in the pool. Species that are comparatively weak or have stopped improving for a number of generations are removed.  









